{% extends "base.html" %}

{% block title %}ã‚¿ã‚¹ã‚¯ä¸€è¦§ - Smart ToDo App{% endblock %}

{% block content %}
<div class="filter-section">
    <form method="GET" action="/" class="filter-group">
        <div>
            <label for="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</label>
            <select name="status" id="status">
                <option value="all" {% if status_filter == 'all' %}selected{% endif %}>ã™ã¹ã¦</option>
                <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>æœªå®Œäº†</option>
                <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>å®Œäº†</option>
            </select>
        </div>
        <div>
            <label for="category">ã‚«ãƒ†ã‚´ãƒª:</label>
            <select name="category" id="category">
                <option value="">ã™ã¹ã¦</option>
                <option value="work" {% if category_filter == 'work' %}selected{% endif %}>ä»•äº‹</option>
                <option value="personal" {% if category_filter == 'personal' %}selected{% endif %}>å€‹äºº</option>
                <option value="shopping" {% if category_filter == 'shopping' %}selected{% endif %}>è²·ã„ç‰©</option>
                <option value="other" {% if category_filter == 'other' %}selected{% endif %}>ãã®ä»–</option>
            </select>
        </div>
        <div>
            <label for="sort">ã‚½ãƒ¼ãƒˆ:</label>
            <select name="sort" id="sort">
                <option value="created_at" {% if sort_by == 'created_at' %}selected{% endif %}>ä½œæˆæ—¥æ™‚</option>
                <option value="priority" {% if sort_by == 'priority' %}selected{% endif %}>å„ªå…ˆåº¦</option>
                <option value="due_date" {% if sort_by == 'due_date' %}selected{% endif %}>æœŸé™</option>
            </select>
        </div>
        <div>
            <label for="q">æ¤œç´¢:</label>
            <input type="text" name="q" id="q" value="{{ search_query or '' }}" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢">
        </div>
        <div>
            <button type="submit" class="btn btn-primary">ãƒ•ã‚£ãƒ«ã‚¿</button>
            <a href="/" class="btn btn-secondary">ãƒªã‚»ãƒƒãƒˆ</a>
        </div>
    </form>
</div>

<div style="text-align: right; margin-bottom: 20px;">
    <a href="/tasks/new" class="btn btn-primary">æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ</a>
</div>

{% if tasks %}
    {% for task in tasks %}
    <div class="task-card">
        <div class="task-header">
            <div class="task-title">
                {% if task.status == 'completed' %}
                    <s>{{ task.title }}</s>
                {% else %}
                    {{ task.title }}
                {% endif %}
            </div>
            <div>
                <span class="badge badge-{{ task.priority }}">{{ task.priority }}</span>
                <span class="badge badge-{{ task.status }}">
                    {% if task.status == 'pending' %}æœªå®Œäº†{% else %}å®Œäº†{% endif %}
                </span>
            </div>
        </div>
        {% if task.description %}
        <p style="margin: 10px 0; color: #6b7280;">{{ task.description }}</p>
        {% endif %}
        <div class="task-meta">
            {% if task.category %}
            <span>ã‚«ãƒ†ã‚´ãƒª: {{ task.category }}</span>
            {% endif %}
            {% if task.due_date %}
            <span>æœŸé™: {{ task.due_date.strftime('%Y-%m-%d %H:%M') }}</span>
            {% endif %}
            {% if task.location %}
            <span>å ´æ‰€: {{ task.location }}</span>
            {% endif %}
            {% if task.weather %}
            <span style="display: inline-flex; align-items: center; gap: 5px;">
                {% if task.weather.is_bad_weather %}
                âš ï¸
                {% endif %}
                ğŸŒ¤ï¸ {{ task.weather.condition }}
                {% if task.weather.temp is not none %}
                {{ task.weather.temp }}Â°C
                {% endif %}
            </span>
            {% endif %}
            <span>ä½œæˆ: {{ task.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
        </div>
        <div class="actions">
            <a href="/tasks/{{ task.id }}" class="btn btn-primary">è©³ç´°</a>
            <a href="/tasks/{{ task.id }}/edit" class="btn btn-secondary">ç·¨é›†</a>
            <form method="POST" action="/tasks/{{ task.id }}/toggle" style="display: inline;">
                <button type="submit" class="btn btn-success">
                    {% if task.status == 'pending' %}å®Œäº†{% else %}æœªå®Œäº†ã«æˆ»ã™{% endif %}
                </button>
            </form>
            <form method="POST" action="/tasks/{{ task.id }}/delete" style="display: inline;" onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                <button type="submit" class="btn btn-danger">å‰Šé™¤</button>
            </form>
        </div>
    </div>
    {% endfor %}
{% else %}
    <div class="task-card" style="text-align: center; padding: 40px;">
        <p style="font-size: 18px; color: #6b7280;">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</p>
        <a href="/tasks/new" class="btn btn-primary" style="margin-top: 20px;">æœ€åˆã®ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ</a>
    </div>
{% endif %}
{% endblock %}







